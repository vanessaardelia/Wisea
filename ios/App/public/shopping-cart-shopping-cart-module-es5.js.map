{"version":3,"sources":["webpack:///src/app/menu/explore/shopping-cart/shopping-cart.page.html","webpack:///src/app/menu/explore/shopping-cart/shopping-cart-routing.module.ts","webpack:///src/app/menu/explore/shopping-cart/shopping-cart.module.ts","webpack:///src/app/menu/explore/shopping-cart/shopping-cart.page.scss","webpack:///src/app/menu/explore/shopping-cart/shopping-cart.page.ts"],"names":["routes","path","component","loadChildren","then","m","PaymentSummaryPageModule","ShoppingCartPageRoutingModule","imports","forChild","exports","ShoppingCartPageModule","declarations","ShoppingCartPage","route","wisataService","storage","formBuilder","authService","historyService","firestore","toastController","shopCart","cartItems","paid","nama","shopForm","group","nik","required","tlp","qty","wisataId","snapshot","paramMap","get","wisataList","getWisataDetail","pipe","imageDetail","gambarUrl","gambar","forEach","index","getImageUrl","max","tiketTersedia","harga","total","wisata","oldTiketTerjual","tiketTerjual","oldTiketTersedia","imageName","ref","getDownloadURL","value","date","Date","getUserData","subscribe","userProfile","oldBalance","balance","email","presentToast","collection","doc","update","uid","addHistory","name","create","message","duration","color","position","mode","toast","present","selector","template"],"mappings":"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","file":"shopping-cart-shopping-cart-module-es5.js","sourcesContent":["export default \"<ion-header [translucent]=\\\"true\\\">\\r\\n  <ion-toolbar color=\\\"primary\\\">\\r\\n    <ion-buttons slot=\\\"start\\\" [routerLink]=\\\"['/menu/tabs/explore/explore-detail/', (wisataList | async)?.id]\\\">\\r\\n      <ion-icon class=\\\"header__icon\\\" src='assets/icon/backButton.svg'></ion-icon>\\r\\n    </ion-buttons>\\r\\n    <ion-title class=\\\"ion-text-center\\\">\\r\\n      Wisea\\r\\n    </ion-title>\\r\\n  </ion-toolbar>\\r\\n</ion-header>\\r\\n\\r\\n<ion-content [fullscreen]=\\\"true\\\" color=\\\"background\\\">\\r\\n    <form [formGroup]=\\\"shopForm\\\" (submit)=\\\"shopping()\\\">\\r\\n  <ion-item-group class=\\\"body__container\\\">\\r\\n      <ion-item-group class=\\\"body__card\\\">\\r\\n        <ion-card *ngIf=\\\"(wisataList | async)\\\">\\r\\n          <ion-card-header>\\r\\n            <ion-row>\\r\\n              <ion-item-group class=\\\"cart__avatar\\\">\\r\\n                <ion-avatar slot=\\\"start\\\">\\r\\n                  <img [src]=\\\"(imageDetail[0] | async)\\\">\\r\\n                </ion-avatar>\\r\\n              </ion-item-group>\\r\\n              <ion-col>\\r\\n                <ion-card-title style=\\\"color: var(--ion-color-primary); font-size: 16px;\\\"><strong>{{ (wisataList | async)?.nama }}</strong></ion-card-title>\\r\\n                <ion-row>\\r\\n                  <ion-chip color=\\\"success\\\">\\r\\n                    <ion-label style=\\\"font-size: 12px;\\\">{{ (wisataList | async)?.kategori }}</ion-label>\\r\\n                  </ion-chip>\\r\\n                  <ion-item-group>\\r\\n                    <ion-row style=\\\"display: flex;\\\">\\r\\n                      <ion-icon name=\\\"bag-handle-outline\\\" style=\\\"font-size: 16px; align-self: center; margin-right: 8px;\\\"></ion-icon>\\r\\n                      <p>{{ (wisataList | async)?.harga | currency:'IDR':'symbol-narrow':'3.0' }}</p>\\r\\n                    </ion-row>\\r\\n                  </ion-item-group>\\r\\n                </ion-row>\\r\\n                <ion-item-group class=\\\"btn__qty\\\">\\r\\n                  <ion-row>\\r\\n                    <ion-icon class=\\\"header__icon btn__qty-remove\\\" name=\\\"remove-circle\\\" (click)=\\\"decrementQty()\\\" item-right></ion-icon>\\r\\n                    <ion-input class=\\\"btn__qty-value\\\" type=\\\"number\\\" min=\\\"0\\\" [(ngModel)]=\\\"qty\\\" formControlName=\\\"qty\\\"></ion-input>\\r\\n                    <ion-icon class=\\\"header__icon btn__qty-add\\\" name=\\\"add-circle\\\" (click)=\\\"incrementQty()\\\" item-right></ion-icon>\\r\\n                  </ion-row>\\r\\n                </ion-item-group>\\r\\n              </ion-col>\\r\\n            </ion-row>\\r\\n          </ion-card-header>\\r\\n        </ion-card>\\r\\n        <ion-item-group class=\\\"body__form\\\">\\r\\n          <ion-label style=\\\"color: var(--ion-color-primary); margin: 8px 8px;\\\"><strong>Data pribadi</strong></ion-label>\\r\\n          <ion-item-group>\\r\\n            <ion-item>\\r\\n              <ion-label position=\\\"stacked\\\">NIK</ion-label>\\r\\n              <ion-input autofocus type=\\\"number\\\" clear-input required formControlName=\\\"nik\\\"></ion-input>\\r\\n            </ion-item>\\r\\n            <ion-item>\\r\\n              <ion-label position=\\\"stacked\\\">Nomor telepon</ion-label>\\r\\n              <ion-input clear-input type=\\\"number\\\" required formControlName=\\\"tlp\\\"></ion-input>\\r\\n            </ion-item>\\r\\n          </ion-item-group>\\r\\n        </ion-item-group>\\r\\n      </ion-item-group>\\r\\n      <ion-item-group class=\\\"body__total\\\">\\r\\n        <ion-row class=\\\"body__total-buy\\\">\\r\\n          <ion-label style=\\\"color: var(--ion-color-primary); font-size: 14px;\\\"><strong>Jumlah</strong></ion-label>\\r\\n          <ion-label style=\\\"font-size: 14px;\\\">{{ qty }}</ion-label>\\r\\n        </ion-row>\\r\\n        <ion-row class=\\\"body__total-buy\\\">\\r\\n          <ion-label style=\\\"color: var(--ion-color-primary);\\\"><strong>Total</strong></ion-label>\\r\\n          <ion-label>{{ total | currency:'IDR'}}</ion-label>\\r\\n        </ion-row>\\r\\n        <ion-button type=\\\"submit\\\" shape=\\\"round\\\" expand=\\\"full\\\" class=\\\"btn\\\" [disabled]=\\\"!shopForm.valid\\\">Bayar</ion-button>\\r\\n      </ion-item-group>\\r\\n  </ion-item-group>\\r\\n  </form>\\r\\n</ion-content>\\r\\n\";","import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { ShoppingCartPage } from './shopping-cart.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: ShoppingCartPage\r\n  },\r\n  {\r\n    path: 'payment-summary',\r\n    loadChildren: () => import('./payment-summary/payment-summary.module').then( m => m.PaymentSummaryPageModule)\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class ShoppingCartPageRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { ShoppingCartPageRoutingModule } from './shopping-cart-routing.module';\r\n\r\nimport { ShoppingCartPage } from './shopping-cart.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    ShoppingCartPageRoutingModule,\r\n    ReactiveFormsModule\r\n  ],\r\n  declarations: [ShoppingCartPage]\r\n})\r\nexport class ShoppingCartPageModule {}\r\n","export default \".header__icon {\\n  font-size: 24px;\\n}\\n\\n.cart__avatar {\\n  margin-right: 8px;\\n}\\n\\n.body__container {\\n  background-color: #FFF9E9 !important;\\n  padding-top: 32px;\\n}\\n\\n.body__card {\\n  border-radius: 24px;\\n  background-color: white;\\n  padding: 32px 0px;\\n  margin-top: -48px;\\n}\\n\\n.body__form {\\n  padding: 0px 8px 8px;\\n}\\n\\n.body__total {\\n  background-color: #FFF9E9;\\n  padding: 16px 8px;\\n}\\n\\n.body__total-buy {\\n  display: flex;\\n  justify-content: space-between;\\n  margin-bottom: 8px;\\n}\\n\\n.btn {\\n  margin-top: 16px;\\n}\\n\\n.btn__qty {\\n  display: flex;\\n  justify-content: space-between;\\n}\\n\\n.btn__qty-add {\\n  color: #7BA57F;\\n  align-self: center;\\n}\\n\\n.btn__qty-remove {\\n  color: #F06F53;\\n  align-self: center;\\n}\\n\\n.btn__qty-value {\\n  width: 40px;\\n  align-self: center;\\n  text-align: center;\\n}\\n\\nion-card {\\n  background-color: #FFF9E9;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcHAvbWVudS9leHBsb3JlL3Nob3BwaW5nLWNhcnQvc2hvcHBpbmctY2FydC5wYWdlLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0k7RUFDRSxlQUFBO0FBQU47O0FBS0k7RUFDRSxpQkFBQTtBQUZOOztBQU9JO0VBQ0Usb0NBQUE7RUFDQSxpQkFBQTtBQUpOOztBQU1JO0VBQ0UsbUJBQUE7RUFDQSx1QkFBQTtFQUNBLGlCQUFBO0VBQ0EsaUJBQUE7QUFKTjs7QUFNSTtFQUNFLG9CQUFBO0FBSk47O0FBTUk7RUFDRSx5QkFBQTtFQUNBLGlCQUFBO0FBSk47O0FBS007RUFDRSxhQUFBO0VBQ0EsOEJBQUE7RUFDQSxrQkFBQTtBQUhSOztBQVFFO0VBQ0UsZ0JBQUE7QUFMSjs7QUFNSTtFQUNFLGFBQUE7RUFDQSw4QkFBQTtBQUpOOztBQUtNO0VBQ0UsY0FBQTtFQUNBLGtCQUFBO0FBSFI7O0FBS007RUFDRSxjQUFBO0VBQ0Esa0JBQUE7QUFIUjs7QUFLTTtFQUNFLFdBQUE7RUFDQSxrQkFBQTtFQUNBLGtCQUFBO0FBSFI7O0FBUUU7RUFDRSx5QkFBQTtBQUxKIiwiZmlsZSI6InNyYy9hcHAvbWVudS9leHBsb3JlL3Nob3BwaW5nLWNhcnQvc2hvcHBpbmctY2FydC5wYWdlLnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyIuaGVhZGVyIHtcclxuICAgICZfX2ljb257XHJcbiAgICAgIGZvbnQtc2l6ZTogMjRweDtcclxuICAgIH1cclxuICB9XHJcbiAgXHJcbiAgLmNhcnQge1xyXG4gICAgJl9fYXZhdGFyIHtcclxuICAgICAgbWFyZ2luLXJpZ2h0OiA4cHg7XHJcbiAgICB9XHJcbiAgfVxyXG4gIFxyXG4gIC5ib2R5IHtcclxuICAgICZfX2NvbnRhaW5lciB7XHJcbiAgICAgIGJhY2tncm91bmQtY29sb3I6ICNGRkY5RTkgIWltcG9ydGFudDtcclxuICAgICAgcGFkZGluZy10b3A6IDMycHg7XHJcbiAgICB9XHJcbiAgICAmX19jYXJkIHtcclxuICAgICAgYm9yZGVyLXJhZGl1czogMjRweDtcclxuICAgICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7XHJcbiAgICAgIHBhZGRpbmc6IDMycHggMHB4O1xyXG4gICAgICBtYXJnaW4tdG9wOiAtNDhweFxyXG4gICAgfVxyXG4gICAgJl9fZm9ybSB7XHJcbiAgICAgIHBhZGRpbmc6IDBweCA4cHggOHB4O1xyXG4gICAgfVxyXG4gICAgJl9fdG90YWwge1xyXG4gICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRkZGOUU5O1xyXG4gICAgICBwYWRkaW5nOiAxNnB4IDhweDtcclxuICAgICAgJi1idXkge1xyXG4gICAgICAgIGRpc3BsYXk6IGZsZXg7XHJcbiAgICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xyXG4gICAgICAgIG1hcmdpbi1ib3R0b206IDhweDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICAuYnRuIHtcclxuICAgIG1hcmdpbi10b3A6IDE2cHg7XHJcbiAgICAmX19xdHkge1xyXG4gICAgICBkaXNwbGF5OiBmbGV4O1xyXG4gICAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47XHJcbiAgICAgICYtYWRkIHtcclxuICAgICAgICBjb2xvcjogIzdCQTU3RjtcclxuICAgICAgICBhbGlnbi1zZWxmOiBjZW50ZXI7XHJcbiAgICAgIH1cclxuICAgICAgJi1yZW1vdmUge1xyXG4gICAgICAgIGNvbG9yOiAjRjA2RjUzO1xyXG4gICAgICAgIGFsaWduLXNlbGY6IGNlbnRlcjtcclxuICAgICAgfVxyXG4gICAgICAmLXZhbHVlIHtcclxuICAgICAgICB3aWR0aDogNDBweDtcclxuICAgICAgICBhbGlnbi1zZWxmOiBjZW50ZXI7XHJcbiAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG4gIFxyXG4gIGlvbi1jYXJkIHtcclxuICAgIGJhY2tncm91bmQtY29sb3I6ICNGRkY5RTk7XHJcbiAgfSJdfQ== */\";","import { Component, OnInit } from '@angular/core';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { Observable } from 'rxjs';\r\nimport { WisataDetail } from '../../../model/wisata-detail.interface';\r\nimport { UserData } from '../../../model/user.model';\r\nimport { WisataService } from '../../../service/wisata.service';\r\nimport { AuthService, User } from '../../../service/auth.service';\r\nimport { HistoryService } from 'src/app/service/history.service';\r\nimport { map } from 'rxjs/operators';\r\nimport { AngularFireStorage } from \"@angular/fire/storage\";\r\nimport { FormGroup, FormBuilder, Validators } from '@angular/forms';\r\nimport { AngularFirestore } from '@angular/fire/firestore';\r\nimport { ToastController } from '@ionic/angular';\r\n\r\n@Component({\r\n  selector: 'app-shopping-cart',\r\n  templateUrl: './shopping-cart.page.html',\r\n  styleUrls: ['./shopping-cart.page.scss'],\r\n})\r\nexport class ShoppingCartPage implements OnInit {\r\n  public wisataList: Observable<WisataDetail>\r\n  public imageDetail: Observable<string>;\r\n  public shopCart = new Observable<History>();\r\n  public shopForm: FormGroup;\r\n  cartItems: any[] = [];\r\n  total: number;\r\n  qty: number;\r\n  max: number;\r\n  harga: number;\r\n  wisata: string;\r\n  wisataId: string;\r\n  oldTiketTerjual: number;\r\n  oldTiketTersedia: number;\r\n  oldBalance: number;\r\n  userProfile: any;\r\n  paid: Boolean = false;\r\n  public nama: any = [];\r\n\r\n  constructor(\r\n    private route: ActivatedRoute,\r\n    private wisataService: WisataService,\r\n    private storage: AngularFireStorage,\r\n    formBuilder: FormBuilder,\r\n    private authService: AuthService,\r\n    private historyService: HistoryService,\r\n    private firestore: AngularFirestore,\r\n    private toastController: ToastController,\r\n  ) {\r\n    this.shopForm = formBuilder.group({\r\n      nik: ['', Validators.required],\r\n      tlp: ['', Validators.required],\r\n      qty: ['', Validators.required]\r\n    });\r\n   }\r\n\r\n  ngOnInit() {\r\n    this.wisataId = this.route.snapshot.paramMap.get('id');\r\n    this.wisataList = this.wisataService.getWisataDetail(this.wisataId).pipe(\r\n      map(wisataList => {\r\n        this.imageDetail = new Observable<string>();\r\n        wisataList.gambarUrl = new Observable<string[]>();\r\n        wisataList.gambar.forEach((gambar, index) => {\r\n          this.imageDetail[index] = this.getImageUrl(gambar);\r\n        });\r\n        this.max = wisataList.tiketTersedia;\r\n        this.harga = wisataList.harga;\r\n        this.total = this.harga;\r\n        this.qty = 1;\r\n        this.wisata = wisataList.nama;\r\n        this.oldTiketTerjual = wisataList.tiketTerjual;\r\n        this.oldTiketTersedia = wisataList.tiketTersedia;\r\n        return wisataList;\r\n      })\r\n    );\r\n  }\r\n\r\n  getImageUrl(imageName) {\r\n    return this.storage.ref(`wisata/${imageName}`).getDownloadURL();\r\n  }\r\n\r\n  incrementQty() {\r\n    this.qty++;\r\n    this.total = this.qty * this.harga;\r\n    if(this.qty > this.max) {\r\n      this.qty = this.max;\r\n    }\r\n  }\r\n\r\n  decrementQty() {\r\n    this.qty--;\r\n    this.total = this.qty * this.harga;\r\n    if(this.qty < 1) {\r\n      this.qty = 1;\r\n      this.total = this.harga;\r\n    }\r\n  }\r\n\r\n  shopping() {\r\n    const qty = this.shopForm.value.qty;\r\n    const nik = this.shopForm.value.nik;\r\n    const tlp = this.shopForm.value.tlp;\r\n    const date = new Date();\r\n\r\n    this.authService.getUserData().subscribe(ref => {\r\n      this.userProfile = ref;\r\n      this.oldBalance = this.userProfile.balance;\r\n      const email = this.userProfile.email;\r\n\r\n      if(this.paid === false){\r\n        if(this.oldBalance < this.total || this.oldTiketTersedia < this.qty) {\r\n          this.presentToast();\r\n        } else if(!this.paid){\r\n            this.firestore.collection('wisata').doc<WisataDetail>(this.wisataId).update({\r\n              tiketTerjual: (this.oldTiketTerjual + qty),\r\n              tiketTersedia: (this.oldTiketTersedia - qty)\r\n            });\r\n\r\n            this.firestore.collection('users').doc<UserData>(this.userProfile.uid).update({\r\n              balance: (this.oldBalance - this.total)\r\n            });\r\n\r\n            this.historyService.addHistory(qty, this.userProfile.name, date, this.wisata, this.total, email, tlp, false, nik)\r\n            this.paid = true;\r\n        }\r\n    }\r\n    });\r\n  }\r\n\r\n  async presentToast() {\r\n    const toast = await this.toastController.create({\r\n      message: 'Saldo anda tidak cukup.',\r\n      duration: 2000,\r\n      color: 'danger',\r\n      position: 'top',\r\n      mode: 'ios'\r\n    });\r\n    toast.present();\r\n  }\r\n\r\n}\r\n"]}